<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DüèÄACH</title>
  <link rel="icon" href="/static/favicon.ico">

  <!-- Core app/scripts (load each ONCE) -->
  <script src="/static/js/coachAssistant.js"></script>

  <!-- Core libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>

  <!-- MediaPipe Pose Model -->
  <script type="module">
    import { FilesetResolver, PoseLandmarker } from 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/vision_bundle.mjs';
    window.FilesetResolver = FilesetResolver;
    window.PoseLandmarker = PoseLandmarker;
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="static/style.css" />
  <!-- Boxicons -->
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

</head>

<body>

  <!-- Overlay Prompt Message -->
  <div id="overlayPrompt" class="prompt-message" style="display:none;">Tap the hoop to begin setup</div>
  <div id="promptBar"></div>

  <!-- ‚úÖ Main Video + Overlay -->
  <div class="session-container">
    <div class="video-frame">
      <video id="videoPlayer" muted playsinline></video>
      <canvas id="overlay"></canvas>
      <div class="session-status">SESSION IN PROGRESS...</div>
    </div>
  </div>

  <!-- ‚úÖ Coach Feedback + Shot Summary -->
  <div id="coachNotes" style="
    position: absolute; top: 10px; left: 10px;
    max-width: 400px; background: rgba(0,0,0,0.7); color: #fff;
    padding: 12px 16px; border-radius: 8px;
    font-size: 14px; line-height: 1.4; z-index: 999;">
    <strong>ü§ñ Coach Feedback</strong><br>
    <span style="color:gray;">(No shot yet)</span>
  </div>

  <div id="shotOverlaySummary" style="
    position: absolute;
    bottom: 80px;
    right: 20px;
    padding: 10px 16px;
    background: rgba(0,0,0,0.75);
    color: white;
    border-radius: 10px;
    font-size: 14px;
    line-height: 1.4;
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 20;
    pointer-events: none;
    display: none;"></div>

  <!-- Hidden upload control the new ‚ÄúContent‚Äù menu will click -->
  <input type="file" id="videoInput" accept="video/*" hidden />

  <!-- Mount the new Hamburger menu + Feedback widget -->
  <script type="module">
    import { installFeedbackWidget } from '/static/js/feedback_widget.js';
    window.addEventListener('DOMContentLoaded', () => installFeedbackWidget());
  </script>


  <!-- (Keep) lightweight helpers already on the page -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const promptOverlay = document.getElementById("overlayPrompt");

      window.showPrompt = (message) => {
        promptOverlay.textContent = message;
        promptOverlay.style.display = "block";
      };
      window.hidePrompt = () => { promptOverlay.style.display = "none"; };

      window.lockHoop = function () {
        hidePrompt();
        console.log("‚úÖ Hoop lock UI confirmed");
      };

      window.endSession = () => {
        alert("‚úÖ Session ended. Scroll down for summary.");
      };
    });
  </script>

  <script>
    function startNativeVoice() {
      window.webkit?.messageHandlers?.doach?.postMessage({ action: 'startVoice' });
    }
    function stopNativeVoice() {
      window.webkit?.messageHandlers?.doach?.postMessage({ action: 'stopVoice' });
    }
    </script>

    

<!-- ui menu (classic, auto-mounts) -->
<script src="/static/js/ui_menu.js?v=2"></script>

<!-- app entry (ESM) imports the rest of your modules -->
<script type="module" src="/static/js/app.js?v=20250820"></script>

<!-- local detector enable (ESM) -->
<script type="module">
  (async () => {
    if (!window.localDetector) {
      console.warn('[LocalDetector] not loaded; using server detector.');
      return;
    }
    try {
      const ok = await window.localDetector.enable(
        '/static/models/best.onnx',
        ['basketball','hoop','net','backboard','player']
      );
      console.log(ok ? '‚úÖ Local detector enabled' : '‚¨áÔ∏è Using server detector');
    } catch (e) {
      console.warn('[LocalDetector] init failed; using server detector.', e);
    }
  })();
</script>


</body>
</html>
